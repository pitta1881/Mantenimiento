{% extends "base.html" %}

{% block title %} Gestion de Insumos {% endblock %}

{% block header %}
{% set nombreUsuario = datos.userLogueado %}
{% include 'partials/nav.html' with {nombreUsuario:nombreUsuario} only %}
{% endblock %}

{% block head %}
{{ parent() }}
<meta name="keywords" content="PAW,2018,Templates,PHP"> {% endblock %}

{% block main %}
<div class="contenido3">
    <a href="#" onclick="mostrarFormulario()" id="btnCrearAgente"><img class="iconos" src="/public/res/add.svg"
            title="Crear Insumo"></a>
    <script>
        function mostrarFormulario() {
            var formularioInsumo = document.getElementById('formularioInsumo');
            if (formularioInsumo.style.display == "block") {
                formularioInsumo.style.display = "none";
            } else {
                formularioInsumo.style.display = "block"
            }
        }
    </script>
    <form action="/insumos/administracionInsumos/guardarInsumo" method="post" id="formularioInsumo"
        style="display: none">
        <fieldset class="basicosInsumo">
            <legend> Alta de Insumo</legend>
            <label for="nombreInsumo">Nombre del Insumo</label><span class="asterisco">*</span>
            <input type="text" name="nombreInsumo" autofocus required>
            <label for="stock">Stock</label><span class="asterisco">*</span>
            <input type="number" name="stock" required value="0" min="0">
            <label for="descripcion">Descripcion</label><span class="asterisco">*</span>
            <input type="textarea" name="descripcion" required placeholder="Ingrese la descripcion.."><br>
        </fieldset>
        <input type="submit">
    </form>
    <table id="miTabla">
        <th onclick="sortTable(0,'miTabla')">Nº Insumo</th>
        <th onclick="sortTable(1,'miTabla')">Nombre</th>
        <th onclick="sortTable(2,'miTabla')">Descripcion</th>
        <th onclick="sortTable(3,'miTabla')">Stock Actual</th>
        <th onclick="sortTable(4,'miTabla')">Accion</th>
        {% for insumo in datos.todosInsumos %}
        <tr>
            <td>{{ insumo.idInsumo }}</td>
            <td>{{ insumo.nombreInsumo }}</td>
            <td>{{ insumo.descripcion }}</td>
            <td>{{ insumo.stock }}</td>
            <td>
                <!--SUMAR INSUMOS-->
                <form action="/insumo/sumarStock" method="post" hidden id="formSumar">
                    <input type="text" name="idInsumo" value="{{ insumo.idInsumo }}" hidden>
                    <input type="number" name="cantidad" hidden>
                </form>
                <img class="iconos" src="/public/res/add.svg" title="Sumar Stock"
                    onclick="alertify.prompt('Sumar Stock','Seleccione la cantidad a sumar','',function(evt,value){document.getElementsByName('cantidad')[0].value = value ;document.getElementById('formSumar').submit()},function(){}).set('type', 'number');">
                <!--MODIFICAR INSUMO-->
                <a href='/insumo/modificar/seleccionado?idInsumo={{ insumo.idInsumo }}'>
                    <img class="iconos" src="/public/res/update.svg" title="Modificar">
                </a>
                <!--VER HISTORIAL-->
                <a href="/insumo/verHistorial?idInsumo={{ insumo.idInsumo }}"><img class="iconosTitulo"
                        src="/public/res/historyEstado.svg" title="Ver Historial"></a>
                <!--ELIMINAR INSUMO-->
                {% if insumo.eliminarBool == true %}
                <form action="/insumo/eliminar" method="post" style="display: inline-block"
                    id="formEliminarInsumo{{ insumo.idInsumo }}">
                    <input type="text" name="idInsumo" value="{{ insumo.idInsumo }}" hidden>
                </form>
                <a
                    onclick="alertify.confirm('Eliminar Insumo','¿Esta seguro?',function(){document.getElementById('formEliminarInsumo{{ insumo.idInsumo }}').submit()},function(){})"><img
                        class="iconos" src="/public/res/del.svg" title="Eliminar Insumo"></a>
                {% endif %}
            </td>
        </tr>
        {% else %}
        <h2 class='error'>No hay insumo</h2> {% endfor %}
    </table>
    <section class="paginacion">
        <ul>

            {% if datos.totalPaginas is empty  %}
            <li><a href='/pedido/verTodos?page={{ 1 }}'> 1 </a></li>
            {% endif %}
            {% if datos.totalPaginas|e  %}
            <li><a href='/pedido/verTodos?page={{ 1 }}'> &lt; </a></li>
            {% for i in 1..datos.totalPaginas %}
            <li><a href='/pedido/verTodos?page={{ i }}'> {{ i }} </a></li>
            {% endfor %}
            <li><a href='/pedido/verTodos?page={{ datos.totalPaginas }}'> &gt; </a></li>
            {% endif %}

        </ul>
    </section>
</div>
{% endblock %}