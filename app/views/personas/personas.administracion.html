{% extends "base.html" %}

{% block title %} Gestion de Personas {% endblock %}

{% block header %}
{% set datos = datos|merge({
    "titulo": "Gestión de Personas"
}) %}
{% include 'partials/nav.html' with {datos:datos} only %}
{% endblock %}

{% block head %}
{{ parent() }}
<meta name="keywords" content="PAW,2018,Templates,PHP"> {% endblock %}

{% block main %}
{% if datos.errorInsert %}
<script>
    alertify.alert('Error', 'La Persona ya existe..')
</script>
{% endif %}
<div class="general">
    <a href="#" onclick="mostrarFormulario()" id="btnCrearPersona"><img class="iconos" src="/public/res/add.svg"
            title="Crear Persona"></a>
    <script>
        function mostrarFormulario() {
            var formularioPersona = document.getElementById('formularioPersona');
            if (formularioPersona.style.display == "block") {
                formularioPersona.style.display = "none";
            } else {
                formularioPersona.style.display = "block"
            }
        }
    </script>
    <form action="/persona/altaPersona" method="post" id="formularioPersona" style="display: none">
        <fieldset class="basicosPersona">
            <legend> Alta de Persona</legend>
            <label for="dni">DNI</label><span class="asterisco">*</span>
            <input type="number" name="dni" autofocus required>
            <label for="nombre">Nombre</label><span class="asterisco">*</span>
            <input type="text" name="nombre" required>
            <label for="apellido">Apellido</label><span class="asterisco">*</span>
            <input type="text" name="apellido" required>
            <label for="direccion">Direccion</label>
            <input type="text" name="direccion">
            <br>
            <label for="email">Email</label>
            <input type="email" name="email">
            <label for="fecha_nacimiento">Fecha de Nacimiento</label>
            <input type="date" name="fecha_nacimiento" max="{{ datos.minimo18 }}" min="{{ datos.maximo70 }}">
        </fieldset>
        <input type="submit">
    </form>
    <script>
        $(document).ready(function () {
            $('#miTabla').DataTable();
        });
    </script>
    <table id="miTabla">
        <thead>
            <tr>
                <th onclick="sortTable(0,'miTabla')">DNI </th>
                <th onclick="sortTable(1,'miTabla')">Nombre</th>
                <th onclick="sortTable(2,'miTabla')">Apellido</th>
                <th onclick="sortTable(3,'miTabla')">Direccion</th>
                <th onclick="sortTable(4,'miTabla')">Email</th>
                <th onclick="sortTable(5,'miTabla')">Fecha de Nacimiento</th>
                <th onclick="sortTable(6,'miTabla')">Accion</th>
            </tr>
        </thead>
        {% for persona in datos.todasPersonas %}
        {% if persona.dni != '0' %}
        <tr>
            <td>{{ persona.dni }}</td>
            <td>{{ persona.nombre }}</td>
            <td>{{ persona.apellido }}</td>
            <td>{{ persona.direccion }}</td>
            <td>{{ persona.email }}</td>
            <td>{{ persona.fecha_nacimiento }}</td>
            <td>
                <a href='/persona/modificarPersona/seleccionado?dni={{ persona.dni }}'>

                    <img class="iconos" src="/public/res/update.svg" title="Modificar">
                </a>
                {% if persona.usado == false %}
                <form action="/persona/eliminar" method="post" style="display: inline-block"
                    id="formEliminarPersona{{ persona.dni }}">
                    <input type="text" name="dni" value="{{ persona.dni }}" hidden>
                </form>
                <a
                    onclick="alertify.confirm('Eliminar Especializacion','¿Esta seguro?',function(){document.getElementById('formEliminarPersona{{ persona.dni }}').submit()},function(){})"><img
                        class="iconos" src="/public/res/del.svg" title="Eliminar Especializacion"></a>
                {% endif %}
            </td>
        </tr>
        {% endif %}
        {% else %}
        <h2 class='error'>No hay Personas</h2> {% endfor %}
    </table>
</div>
{% endblock %}